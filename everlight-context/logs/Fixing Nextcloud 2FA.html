<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Fixing Nextcloud 2FA</title>
</head>
<body>
<hr />
<p>conversation_id: "683a744b-6e30-8011-b2f5-d3cd32929d89"
title: "Fixing Nextcloud 2FA"
accounts: ["Account2_exports"]
models: []
tags: []
message_count: 9</p>
<hr />
<h1 id="fixing-nextcloud-2fa">Fixing Nextcloud 2FA</h1>
<h2 id="system">â€” system</h2>
<h2 id="user">â€” user</h2>
<h2 id="2025-05-31t031523200301z-user">2025-05-31T03:15:23.200301Z â€” user</h2>
<p>{"content_type": "image_asset_pointer", "asset_pointer": "file-service://file-L995kRNprR82Y9dbi39jrK", "size_bytes": 171515, "width": 708, "height": 1536, "fovea": null, "metadata": {"dalle": null, "gizmo": null, "generation": null, "container_pixel_height": null, "container_pixel_width": null, "emu_omit_glimpse_image": null, "emu_patches_override": null, "lpe_keep_patch_ijhw": null, "sanitized": true, "asset_pointer_link": null, "watermarked_asset_pointer": null}}
How do I use occ to fix this </p>
<h2 id="2025-05-31t031524604128z-assistant">2025-05-31T03:15:24.604128Z â€” assistant</h2>
<p>To resolve this <strong>Nextcloud 2FA error</strong> using the <code>occ</code> CLI tool, youâ€™ll want to either:</p>
<ol>
<li><strong>Disable 2FA enforcement for the user</strong>, or  </li>
<li><strong>Configure a valid 2FA method</strong> (like TOTP) via CLI so the user can log in.</li>
</ol>
<hr />
<h2 id="option-1-disable-2fa-for-the-user">ğŸ› ï¸ Option 1: Disable 2FA for the user</h2>
<p>This is the quickest fix, especially if the 2FA method wasnâ€™t initialized properly.</p>
<h3 id="command">Command:</h3>
<pre><code class="language-bash">sudo -u www-data php /path/to/nextcloud/occ twofactorauth:disable &lt;username&gt;
</code></pre>
<p>Replace <code>/path/to/nextcloud/</code> with the actual path (commonly <code>/var/www/nextcloud</code>)<br />
Replace <code>&lt;username&gt;</code> with the actual Nextcloud username.</p>
<hr />
<h2 id="option-2-disable-2fa-app-entirely-if-needed">ğŸ› ï¸ Option 2: Disable 2FA app entirely (if needed)</h2>
<p>If multiple users are affected or the app is misbehaving:</p>
<pre><code class="language-bash">sudo -u www-data php /path/to/nextcloud/occ app:disable twofactor_totp
</code></pre>
<hr />
<h2 id="optional-view-2fa-status">ğŸ›¡ï¸ Optional: View 2FA status</h2>
<p>See which users have 2FA enabled:</p>
<pre><code class="language-bash">sudo -u www-data php /path/to/nextcloud/occ twofactorauth:state &lt;username&gt;
</code></pre>
<hr />
<h2 id="after-fixing">âœ… After Fixing</h2>
<p>Once logged in, go to <strong>Settings â†’ Security</strong> and re-enable a working 2FA method like TOTP (e.g., Google Authenticator) if needed.</p>
<hr />
<p>Would you like me to generate a one-liner for your exact server path and username? If so, let me know the values.</p>
<h2 id="2025-05-31t031531478422z-assistant">2025-05-31T03:15:31.478422Z â€” assistant</h2>
<h2 id="2025-05-31t095926149998z-user">2025-05-31T09:59:26.149998Z â€” user</h2>
<p>How do I make a secondary ad,in account from Terminal</p>
<h2 id="2025-05-31t095927140655z-assistant">2025-05-31T09:59:27.140655Z â€” assistant</h2>
<p>To create a <strong>secondary admin account</strong> in <strong>Nextcloud</strong> using the <code>occ</code> command via terminal, follow these steps:</p>
<hr />
<h2 id="create-a-new-admin-user-from-terminal">ğŸ› ï¸ Create a New Admin User from Terminal</h2>
<h3 id="step-1-create-the-user">ğŸ”¹ Step 1: Create the user</h3>
<pre><code class="language-bash">sudo -u www-data php /path/to/nextcloud/occ user:add &lt;new_username&gt;
</code></pre>
<p>Youâ€™ll be prompted to enter a password and optional email.</p>
<blockquote>
<p>Example:</p>
</blockquote>
<pre><code class="language-bash">sudo -u www-data php /var/www/nextcloud/occ user:add admin2
</code></pre>
<hr />
<h3 id="step-2-add-the-user-to-the-admin-group">ğŸ”¹ Step 2: Add the user to the admin group</h3>
<pre><code class="language-bash">sudo -u www-data php /path/to/nextcloud/occ group:adduser admin &lt;new_username&gt;
</code></pre>
<blockquote>
<p>Example:</p>
</blockquote>
<pre><code class="language-bash">sudo -u www-data php /var/www/nextcloud/occ group:adduser admin admin2
</code></pre>
<hr />
<h3 id="done">âœ… Done!</h3>
<p>This <code>admin2</code> user now has full admin rights and can log in normally.</p>
<hr />
<h2 id="optional-tips">ğŸ§  Optional Tips</h2>
<ul>
<li>If youâ€™re not using <code>www-data</code> (e.g. on some systems it's <code>apache</code> or <code>nginx</code>), adjust the <code>sudo -u</code> user accordingly.</li>
<li>You can check existing groups with:
  <code>bash
  sudo -u www-data php /path/to/nextcloud/occ group:list</code></li>
</ul>
<hr />
<p>Would you like me to generate the exact commands for your setup if you tell me the path to your Nextcloud and the username you'd like to assign?</p>
<h2 id="2025-05-31t100053496692z-user">2025-05-31T10:00:53.496692Z â€” user</h2>
<p>sudo -u www-data php /mnt/data/nextcloud/nextcloud/occ group:adduser admin devs</p>
<h2 id="2025-05-31t100054242927z-assistant">2025-05-31T10:00:54.242927Z â€” assistant</h2>
<p>That command is <strong>almost correct</strong>, assuming:</p>
<ul>
<li>The Nextcloud installation is located at <code>/mnt/data/nextcloud/nextcloud</code></li>
<li>The username you're adding (<code>devs</code>) already exists</li>
</ul>
<hr />
<h2 id="heres-the-correct-command">âœ… Hereâ€™s the correct command:</h2>
<pre><code class="language-bash">sudo -u www-data php /mnt/data/nextcloud/nextcloud/occ group:adduser admin devs
</code></pre>
<p>If the user <code>devs</code> does <strong>not</strong> already exist, you must create them first:</p>
<hr />
<h3 id="step-by-step-to-create-and-promote-devs-as-admin">ğŸ§± Step-by-step (to create and promote <code>devs</code> as admin):</h3>
<pre><code class="language-bash"># Step 1: Create the user (if not already created)
sudo -u www-data php /mnt/data/nextcloud/nextcloud/occ user:add devs

# Step 2: Add the user to the admin group
sudo -u www-data php /mnt/data/nextcloud/nextcloud/occ group:adduser admin devs
</code></pre>
<p>Youâ€™ll be prompted to enter a password for the user when using <code>user:add</code>.</p>
<hr />
<p>Let me know if you want the user to be auto-created with a password and email <strong>non-interactively</strong>, and Iâ€™ll format that version too.</p>
</body>
</html>